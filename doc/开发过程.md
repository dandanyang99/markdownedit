# Markdown 编辑器开发过程文档

## 项目概述

本项目是一个跨平台的 Markdown 编辑器，采用 Electron + React 技术栈构建。该编辑器支持 Markdown 语法编辑，并提供工具栏一键插入各种 Markdown 格式标签，具有实时预览功能。

## 技术选型

### 主要技术栈
- **Electron**: 用于构建跨平台桌面应用
- **React**: 用于构建用户界面
- **Marked**: Markdown 解析库
- **DOMPurify**: HTML 内容净化库，防止 XSS 攻击
- **原生 JavaScript**: 前端交互逻辑

### 为什么选择这些技术
1. **跨平台**: Electron 可以同时构建 Windows、macOS、Linux 应用
2. **Web 技术栈**: 基于 HTML、CSS、JavaScript，开发效率高
3. **社区生态**: 拥有丰富的第三方库支持
4. **易于维护**: Web 技术成熟，学习成本低

## 项目结构

```
markdownedit/
├── package.json           # 项目配置文件
├── main.js               # Electron 主进程文件
├── README.md             # 项目说明文档
├── 开发过程.md           # 开发过程文档
└── src/
    └── renderer/         # 前端渲染进程
        ├── index.html    # 主页面
        ├── index.js      # 前端逻辑
        └── styles.css    # 样式文件
```

## 详细开发步骤

### 第一步：项目初始化

创建了 `package.json` 文件，配置了项目基本信息和依赖：

```json
{
  "name": "markdown-editor",
  "version": "1.0.0",
  "description": "一个跨平台的 Markdown 编辑器",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "dev": "concurrently \"npm run electron-dev\" \"npm run react-dev\"",
    "electron-dev": "nodemon --exec \"npm start\"",
    "react-dev": "cd src/renderer && npm start",
    "build": "npm run build:renderer && npm run build:electron",
    "build:renderer": "cd src/renderer && npm run build",
    "build:electron": "electron-builder --dir"
  },
  "keywords": [
    "markdown",
    "editor",
    "cross-platform"
  ],
  "author": "Your Name",
  "license": "MIT",
  "devDependencies": {
    "electron": "^latest",
    "electron-builder": "^latest",
    "nodemon": "^latest",
    "concurrently": "^latest",
    "@types/node": "^latest",
    "typescript": "^latest"
  },
  "dependencies": {
    "electron-squirrel-startup": "^latest",
    "marked": "^latest",
    "dompurify": "^latest"
  }
}
```

### 第二步：配置 Electron 主进程

创建了 `main.js` 文件，主要功能包括：

1. **窗口管理**: 创建和管理主应用窗口
2. **菜单栏**: 实现文件、编辑、帮助等菜单项
3. **系统集成**: 处理窗口生命周期和系统事件

关键代码片段：
```javascript
const createWindow = () => {
  const mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    minWidth: 800,
    minHeight: 600,
    webPreferences: {
      nodeIntegration: true,
      contextIsolation: false,
      enableRemoteModule: true
    }
  });

  mainWindow.loadFile(path.join(__dirname, 'src/renderer/index.html'));
};
```

### 第三步：前端页面设计

创建了 `src/renderer/index.html`，作为应用的主界面容器：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown 编辑器</title>
  <link rel="stylesheet" href="styles.css">
  <!-- 引入 Marked 库用于 Markdown 解析 -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- 引入 DOMPurify 用于清理 HTML -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script src="index.js"></script>
</body>
</html>
```

### 第四步：样式设计

创建了 `src/renderer/styles.css`，实现了现代化的 UI 设计：

1. **响应式布局**: 使用 Flexbox 实现编辑区和预览区的分栏布局
2. **美观界面**: 简洁的视觉风格，符合现代审美
3. **用户体验**: 舒适的字体、间距和颜色搭配

### 第五步：核心功能实现

在 `src/renderer/index.js` 中实现了编辑器的核心功能：

#### 1. 实时预览功能
```javascript
function updatePreview() {
  const markdown = editor.value;
  const rendered = marked.parse(markdown);
  preview.innerHTML = DOMPurify.sanitize(rendered);
  
  updateStatusBar();
}
```

#### 2. 工具栏功能
实现了多种常用的 Markdown 格式插入功能：
- 加粗、斜体、标题
- 链接、图片插入
- 列表（有序/无序）
- 代码块和内联代码
- 引用格式

#### 3. 通用插入函数
```javascript
function insertMarkdownSyntax(prefix, suffix, placeholder) {
  const startPos = editor.selectionStart;
  const endPos = editor.selectionEnd;
  const selectedText = editor.value.substring(startPos, endPos);
  
  const textToInsert = selectedText || placeholder;
  
  const before = editor.value.substring(0, startPos);
  const after = editor.value.substring(endPos, editor.value.length);
  
  editor.value = before + prefix + textToInsert + suffix + after;
  
  // 设置新的光标位置
  let newPos;
  if (selectedText) {
    newPos = startPos + prefix.length + selectedText.length + suffix.length;
  } else {
    newPos = startPos + prefix.length;
  }
  
  editor.setSelectionRange(newPos, newPos);
  editor.focus();
  updatePreview();
}
```

#### 4. 状态栏功能
实时显示行数和字符数统计信息。

## 功能特性

### 1. 编辑功能
- 实时 Markdown 语法解析
- 语法高亮显示
- 自动保存草稿

### 2. 工具栏功能
- **B**: 插入加粗语法 `**加粗文字**`
- **I**: 插入斜体语法 `*斜体文字*`
- **H**: 插入标题语法 `### 标题`
- **🔗**: 插入链接语法 `[链接描述](https://)`
- **🖼️**: 插入图片语法 `![图片描述](https://)`
- **•**: 插入无序列表 `- `
- **1.**: 插入有序列表 `1. `
- **{}**: 插入内联代码语法 `` `代码` ``
- ****{}**: 插入代码块语法
- **❝**: 插入引用语法 `> `

### 3. 预览功能
- 实时渲染 Markdown 内容
- 支持所有标准 Markdown 语法
- 安全的 HTML 输出（通过 DOMPurify 净化）

### 4. 状态显示
- 行数统计
- 字符数统计

## 项目特点

### 1. 跨平台兼容
- 使用 Electron 技术，一次开发，多平台部署
- 支持 Windows、macOS、Linux 系统

### 2. 安装配置优化
- 使用国内镜像源加速下载
- 正确的依赖版本号格式
- 解决常见的安装错误

### 2. 用户友好
- 直观的工具栏设计
- 即时预览功能
- 清晰的状态信息显示

### 3. 性能优化
- 响应式的界面更新
- 高效的 Markdown 解析
- 轻量级的依赖库

### 4. 安全性
- 使用 DOMPurify 净化 HTML 输出
- 防止 XSS 攻击
- 安全的内容渲染

## 运行与部署

### 开发环境搭建
1. 安装 Node.js（版本 12.x 或更高）
2. 克隆项目代码
3. 安装依赖：`npm install`
4. 启动开发模式：`npm start`

### 生产环境构建
- 构建应用：`npm run build`

## 常见问题及解决方案

### 1. 版本号格式错误
**问题**: `npm error code EINVALIDTAGNAME` - Invalid tag name "^latest" of package

**解决方案**: 将 package.json 中的依赖版本号从 `"^latest"` 修改为 `"latest"`

### 2. 权限或文件占用错误
**问题**: `npm error code EBUSY` - resource busy or locked

**解决方案**: 
- 终止相关的 node.exe 和 electron.exe 进程
- 删除被占用的 node_modules 目录
- 重新安装依赖

### 3. 网络超时错误
**问题**: `npm error RequestError: connect ETIMEDOUT`

**解决方案**: 
- 使用国内 npm 镜像源安装依赖
- 配置 .npmrc 文件指定 Electron 镜像源

## 问题修复记录

### Markdown 编辑框不显示问题

**问题现象**: 应用启动后窗口正常显示，但 Markdown 编辑框不可见，工具栏按钮功能缺失。

**根本原因**: 
1. [index.js](file://e:\work\markdownedit\src\renderer\index.js) 文件中代码不完整，工具栏按钮事件绑定缺失
2. CSS 样式中编辑框缺少边框和内边距，导致视觉上不明显

**解决方案**:
1. 补充完整的工具栏按钮事件绑定，包括：
   - 标题按钮（#）
   - 链接和图片插入
   - 列表、代码、引用等功能按钮
   - 代码块插入功能
   - 编辑器内容变化监听和预览更新
2. 改进 CSS 样式，使编辑框更加明显：
   - 为编辑器添加边框
   - 添加内边距
   - 为富文本编辑模式添加适当的样式

**验证结果**: 修复后编辑器正常显示，所有工具栏按钮功能正常工作。

## 未来扩展方向

1. **文件操作**: 支持文件的打开、保存功能
2. **主题切换**: 提供深色/浅色主题选项
3. **导出功能**: 支持导出为 HTML、PDF 等格式
4. **插件系统**: 允许用户自定义扩展功能
5. **同步功能**: 支持云同步编辑内容